using System.Collections;
using UnityEngine;
using UnityEngine.SceneManagement;

public class InstanciarObjetos : MonoBehaviour
{
    public bool EstaInstanciando = false;
    public float TempoEntreInstancias = 1;
    public float PorcentagemDeAlvoRuim = 30;
    public float PorcentagemDeBalaoEspecial = 10;

    public GameObject balao;
    public GameObject BalaoCaveira;
    public GameObject balaodoTempo;

    public contagemR1 cronometro;

    public Transform Objeto_Pai;
    public Transform Objeto_Pai1;
    public Transform Objeto_Pai2;

    // Número (índice) da próxima cena no Build Settings
    public int indiceProximaCena = 1;

    void Update()
    {
        if (cronometro.tempoAtual <= 0)
        {
            MudarCena();
        }

        if (EstaInstanciando)
        {
            EstaInstanciando = false;
            Invoke("InstanciarPreFab", TempoEntreInstancias);
        }
    }

    void InstanciarPreFab()
    {
        Transform[] pontosDeSpawn = { Objeto_Pai, Objeto_Pai1, Objeto_Pai2 };

        foreach (Transform ponto in pontosDeSpawn)
        {
            float sorteio = Random.Range(0f, 100f);

            GameObject prefabEscolhido;

            if (sorteio <= PorcentagemDeBalaoEspecial)
            {
                prefabEscolhido = balaodoTempo;
            }
            else if (sorteio <= PorcentagemDeBalaoEspecial + PorcentagemDeAlvoRuim)
            {
                prefabEscolhido = BalaoCaveira;
            }
            else
            {
                prefabEscolhido = balao;
            }

            Instantiate(prefabEscolhido, ponto);
        }

        EstaInstanciando = true;
    }

    void MudarCena()
    {
        // Verifica se o índice é válido antes de trocar
        if (indiceProximaCena < SceneManager.sceneCountInBuildSettings)
        {
            SceneManager.LoadScene(indiceProximaCena);
        }
        else
        {
            Debug.LogError("Índice da cena inválido! Verifique o Build Settings.");
        }
    }
}